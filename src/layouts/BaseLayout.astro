---
import { site } from '../data/site';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: string;
}

const { 
  title, 
  description = site.description,
  image = '/og-image.jpg',
  type = 'website'
} = Astro.props;

const pageTitle = title ? `${title} | ${site.title}` : site.title;
const canonicalUrl = new URL(Astro.url.pathname, site.url);
const ogImage = new URL(image, site.url);
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{pageTitle}</title>

  {/* SEO */}
  <meta name="description" content={description} />
  <link rel="canonical" href={canonicalUrl} />

  {/* Favicons */}
  <link rel="icon" href="/favicon.ico?v=3" sizes="any" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png?v=3" />
  <meta name="theme-color" content="#0a0a0a" />

  {/* Open Graph */}
  <meta property="og:type" content={type} />
  <meta property="og:url" content={canonicalUrl} />
  <meta property="og:title" content={pageTitle} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={ogImage} />
  <meta name="twitter:card" content="summary_large_image" />

  {/* Fonts */}
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet" />

  {/* Analytics */}
  <script defer src="https://analytics.bytesbourbonbbq.com/script.js" data-website-id="a4e4bbee-5aa4-41d4-b897-5fe0c4270698"></script>
</head>

<body class="bg-black text-neutral-100 antialiased selection:bg-orange-400/30 min-h-screen flex flex-col">
  <a href="#main" class="skip-link">Skip to content</a>

  {/* Header */}
  <header class="sticky top-0 z-40 border-b border-white/10 bg-black/80 backdrop-blur">
    <div class="mx-auto max-w-7xl px-6 md:px-8">
      <div class="flex items-center justify-between gap-4 py-4">
        {/* Logo */}
        <a href="/" class="flex items-center gap-3 font-semibold tracking-wide hover:text-orange-300 group">
          <img 
            src="/images/brand/bbbq-mark.svg" 
            alt="Bytes • Bourbon • BBQ logo" 
            class="h-16 w-16 transition-all duration-500 group-hover:drop-shadow-[0_0_10px_rgba(255,80,0,0.8)] group-hover:scale-105" 
            loading="lazy" 
          />
          <div class="flex flex-col leading-tight">
            <span>{site.title}</span>
            <span class="hidden sm:block text-xs text-neutral-400">by {site.author.name}</span>
          </div>
        </a>

        {/* Desktop Nav */}
        <nav class="hidden md:flex items-center gap-6 text-sm">
          {site.navigation.map(item => (
            <a 
              class:list={[
                "hover:text-orange-300 transition-colors",
                Astro.url.pathname === item.url && "text-orange-400"
              ]}
              href={item.url}
            >
              {item.title}
            </a>
          ))}
        </nav>

        {/* Mobile Toggle */}
        <button 
          id="navToggle" 
          class="md:hidden rounded-lg px-3 py-2 ring-1 ring-white/10 hover:bg-white/5"
          aria-expanded="false" 
          aria-controls="mobileMenu"
        >
          <span class="sr-only">Menu</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>

      {/* Mobile Menu */}
      <div id="mobileMenu" class="md:hidden hidden pb-4">
        <nav class="grid gap-2 text-sm">
          {site.navigation.map(item => (
            <a 
              class:list={[
                "py-2 hover:text-orange-300",
                Astro.url.pathname === item.url && "text-orange-400"
              ]}
              href={item.url}
            >
              {item.title}
            </a>
          ))}
        </nav>
      </div>
    </div>
  </header>

  {/* Main */}
  <main id="main" class="flex-1">
    <slot />
  </main>

  {/* Footer */}
  <footer class="py-10 border-t border-white/10 text-center text-sm text-neutral-400">
    <nav class="mb-3 flex justify-center gap-6">
      <a class="hover:text-orange-300" href="/about/">About</a>
      <a class="hover:text-orange-300" href="/contact/">Contact</a>
      <a class="hover:text-orange-300" href="/privacy/">Privacy</a>
    </nav>
    <p>
      © {new Date().getFullYear()} {site.title} • 
      <a href="/contact/" class="underline hover:text-orange-300">Contact</a> • 
      <a href={site.author.website} class="underline hover:text-orange-300">
        {site.author.website.replace('https://', '')}
      </a>
    </p>
  </footer>

  {/* Mobile nav script */}
  <script>
    const navToggle = document.getElementById('navToggle');
    const mobileMenu = document.getElementById('mobileMenu');

    navToggle?.addEventListener('click', () => {
      const isHidden = mobileMenu?.classList.toggle('hidden');
      navToggle.setAttribute('aria-expanded', String(!isHidden));
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !mobileMenu?.classList.contains('hidden')) {
        mobileMenu?.classList.add('hidden');
        navToggle?.setAttribute('aria-expanded', 'false');
      }
    });
  </script>
</body>
</html>

<style is:global>
  .skip-link {
    position: absolute;
    left: -9999px;
    top: auto;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }
  
  .skip-link:focus {
    left: 1rem;
    top: 1rem;
    width: auto;
    height: auto;
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    background: #111;
    color: #fff;
    z-index: 9999;
    box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.6);
  }
  
  a:focus-visible, button:focus-visible {
    outline: 2px solid rgba(234, 88, 12, 0.8);
    outline-offset: 2px;
  }
  
  /* Prose for markdown */
  .prose h2 { @apply text-2xl font-semibold mt-8 mb-4; }
  .prose h3 { @apply text-xl font-semibold mt-6 mb-3; }
  .prose p { @apply mb-4 leading-relaxed; }
  .prose ul, .prose ol { @apply mb-4 pl-6; }
  .prose li { @apply mb-2; }
  .prose a { @apply text-orange-400 underline hover:text-orange-300; }
  .prose code { @apply bg-white/10 px-1.5 py-0.5 rounded text-sm; }
  .prose pre { @apply bg-white/5 p-4 rounded-lg overflow-x-auto mb-4; }
  .prose blockquote { @apply border-l-4 border-orange-500 pl-4 italic text-neutral-400; }
  .prose img { @apply rounded-lg my-6; }
  .prose table { @apply w-full mb-4 text-sm; }
  .prose th { @apply text-left p-2 border-b border-white/20 font-semibold; }
  .prose td { @apply p-2 border-b border-white/10; }
</style>
